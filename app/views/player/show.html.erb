<% content_for :main_title do %><%= _("Player") %><% end %>

<h2><%= @player.name %> - <%= @player.full_name %></h2>
<% @player.team_players.each do |tp| %>
  <%= link_to add_wbr_to_string(tp.team.name), action: :team, controller: :championship, id: tp.championship_id, team: tp.team_id %> - <%= tp.championship.full_name %><br/>
<% end %>

<br>

<div class="game_score">
  <% last_championship = nil %>
<% @player.player_games.includes(:game).order("games.date DESC").each do |pg| %>
  <% if last_championship != pg.game.phase.championship %>
    <% last_championship = pg.game.phase.championship %>
    <%= championship_name(pg.game.phase.championship, {:controller => :championship, :action => :team, :id => pg.game.phase.championship, :team => pg.team}) %>
  <% end %>
  <div style='font-size: 11px'><%= formatted_date(pg.game, true) %></div>
      <div class="<%= cycle "table_line_even", "table_line_odd" %> table_row">
        <div class="table_cell" style="width: 92%">
          <%= render :partial => "championship/game_list",
                     :locals => { :highlight_team => pg.team,
                                  :game => pg.game,
                                  :show_country => pg.game.phase.championship.show_country,
                                } %>
          <div class="clearer"></div>
        </div>
        <div class="clearer"></div>
      </div>
      <div class="<%= cycle "table_line_even", "table_line_odd" %> table_row">
        <div class="table_cell" style="width: 92%">
        <div class="clearer"></div>
        <div class='table_cell' style='width: 10%'></div>
        <div class='table_cell' style='width: 10%'>On: <%= pg.on %></div>
        <div class='table_cell' style='width: 10%'>Off: <%= pg.off %></div>
	<div class='table_cell' style='color: rgb(237,194,64); width: 5%'><% if pg.yellow %><%= image_tag "yells.gif" %><% end %></div>
	<div class='table_cell' style='color: rgb(255,0,0); width: 5%'><% if pg.red %><%= image_tag "reds.gif" %><% end %></div>
	<div class='table_cell' style='font-size: 10px'><%= pg.game.goals.where(player_id: @player.id, own_goal: false).map{|x| "#{image_tag('goal.png')} #{x.time}' "}.join.html_safe %></div>
	<div class="clearer"></div>
      </div>
    </div>
<br>
<br>
<% end %>
</div>

<%= render :partial => "comment/comments", :locals => { :object => @player } %>

<% content_for :sidebar do %>
  <% if can? :manage, @player %>
    <%= link_to _("Edit"), :action => :edit, :id => @player %><br/>
    <%= link_to _("Delete"), { :action => :destroy, :id => @player }, :confirm => _('Are you sure?'), :method => :post %><br/>
  <% end %>
<% end %>
