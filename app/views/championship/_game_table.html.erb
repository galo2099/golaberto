<% cache [ "v1", I18n.locale, @games.all, @games.all.map{|g| [g.home, g.away]}.flatten.sort.uniq, @current_round, @championship.show_country ] do %>

<p>
<%= _("Round") %>: <select id="round_select" name="round">
  <option value=""><%= _("All") %></option>
  <%= options_for_select @rounds, @current_round %>
</select>

<%
observe_field_function = "switch(value) {\n";
@rounds.each do |round|
  observe_field_function << "case '#{round}': document.location = '#{url_for(:page => 1, :round => round)}';break;\n"
end
observe_field_function << "default: document.location = '#{url_for(:page => 1, :round => nil)}';break;\n"
observe_field_function << "}\n"
%>
<%= observe_field 'round_select', :function => observe_field_function %>
</p>
<p>
<%= will_paginate @games %>
</p>
<div>
<% last_played = nil
   last_round = nil
   last_date = nil %>
<% @games.each do |game| %>
  <% if last_played != game.played %>
    <% last_played = game.played %>
    <div class='game_toplay'><%= game.played_str %></div>
  <% end %>
  <% if last_round != game.round %>
    <% last_round = game.round %>
    <div class='game_round'><%= _("Round ") %><%= game.round %></div>
    <% last_date = game.formatted_date %>
    <div class='game_date'><%= game.formatted_date(true) %></div>
  <% end %>
  <% if last_date != game.formatted_date %>
    <% last_date = game.formatted_date %>
    <div class='game_date'><%= game.formatted_date(true) %></div>
  <% end %>
    <div class='table_row'>
      <%= render :partial => "game_list",
        :locals => { :game => game,
                     :show_country => @championship.show_country } %>
      <div class='clearer'></div>
    </div>
<% end %>
</div>
<p>
<%= will_paginate @games %>
</p>

<% end %>
